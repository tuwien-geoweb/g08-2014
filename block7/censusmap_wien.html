<!DOCTYPE html>
<html>
  <head>
    <title>Boundless Census Map</title>
    <!-- JQuery -->
    <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <!-- OpenLayers -->
    <link rel="stylesheet" href="http://openlayers.org/en/v3.0.0/css/ol.css" type="text/css">
    <script src="http://openlayers.org/en/v3.0.0/build/ol.js" type="text/javascript"></script>
    <!-- Our Application -->
    <style>
      html, body, #map {
        height: 100%;
      }
      #map {
        padding-top: 50px;
      }
      .legend {
        position: absolute;
        z-index: 1;
        left: 10px;
        bottom: 10px;
        opacity: 0.6;
      }
            .popover {
        max-width: 500px;
      }
      .popover-title {
        float: right;
        background: none;
        border: 0;
        cursor: pointer;
      }
      .popover-content iframe {
        width: 480px;
        height: 120px;
        border: 0;
      }
            .navbar-form .input-group {
        width: 300px;
        padding-right: 60px;
        float: left;
      }
      .navbar-form .form-group {
        width: 450px;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">Boundless Census Map</a>
      </div>
      <form class="navbar-form navbar-right">
        <div class="form-group">
          <select id="topics" class="form-control"></select>
      </div>
      <div class="input-group">
        <input type="text" class="form-control" name="query">
        <span class="input-group-btn">
        <button class="btn btn-default" type="submit">
          <span class="glyphicon glyphicon-search"></span>
        </button>
        </span>
      </div>
    </form>  
      <form id="button">
        <input name="locate-me" type="button"  value="Locate Me" onclick="javascipt:current_location()"> 
      </form>
    </nav>
    <div id="map">
      <!-- GetLegendGraphic, customized with some LEGEND_OPTIONS -->
     <!-- <img class="legend img-rounded" src="http://student.ifip.tuwien.ac.at/geoserver/g08_2014/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=26&HEIGHT=18&STRICT=false&style=g08_2014_stddev&LEGEND_OPTIONS=fontName:sans-serif;fontSize:11;fontAntiAliasing:true;fontStyle:bold;fontColor:0xFFFFFF;bgColor:0x000000">-->
     <div id="popup" data-html="true" data-placement="auto" data-title="&times;">
        <div id="popup-content" style="display:none">
          <iframe seamless></iframe>
          <form class="input-group">
  <input type="text" class="form-control" name="comment">
  <span class="input-group-btn">
    <button class="btn btn-default" type="submit">Comment</button>
  </span>
</form>
            
        </div>
      </div>
    </div>
    
     <script type="text/javascript">
  var marker = new ol.Feature();
  var map = new ol.Map({
  target: 'map',
  layers: [
  new ol.layer.Tile({
  source: 'http://student.ifip.tuwien.ac.at/geoserver/g08_2014/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=26&HEIGHT=18&STRICT=false&style=g08_2014_stddev&LEGEND_OPTIONS=fontName:sans-serif;fontSize:11;fontAntiAliasing:true;fontStyle:bold;fontColor:0xFFFFFF;bgColor:0x000000'
  }),
new ol.layer.Vector({
        source: new ol.source.Vector({
          features: [marker]
        }),
        style: new ol.style.Style({
          image: new ol.style.Icon({
            anchor: [0.5, 46],
            anchorXUnits: 'fraction',
            anchorYUnits: 'pixels',
            opacity: 0.75,
            src: 'https://cloud.githubusercontent.com/assets/9716583/5280362/7085b7c4-7af0-11e4-99fb-2ee019923e19.png'
          })
        })
      })
  ],
  view: new ol.View({
  center: ol.proj.transform([16.3, 48.2], 'EPSG:4326', 'EPSG:3857'),
  zoom: 11,
  maxZoom: 19
  })
  });
  
  var geolocation = new ol.Geolocation({
  projection: 'EPSG:3857'
  });
  geolocation.setTracking(true); // here the browser may ask for confirmation
  geolocation.on('change:position', function() {
  geolocation.setTracking(false);
  map.getView().setCenter(geolocation.getPosition());
  marker.setGeometry(new ol.geom.Point(map.getView().getCenter()));
  });
  
  var form = document.getElementById("search");
  
  form.onsubmit = function(evt) {
  evt.preventDefault();
  var url = 'http://nominatim.openstreetmap.org/search?format=json&q=' + form.query.value;
  var xhr = new XMLHttpRequest();
  
  xhr.open("GET", url, true);
  xhr.onload = function() {
  var result = JSON.parse(xhr.responseText);
  var bbox = result[0].boundingbox;
  var extent = /** @type {ol.Extent} */ [
  parseFloat(bbox[2]), parseFloat(bbox[0]),
  parseFloat(bbox[3]), parseFloat(bbox[1])
  ];
  //map.getView().fitExtent(ol.proj.transformExtent(extent, 'EPSG:4326', 'EPSG:3857'), map.getSize());
  //marker.setGeometry(new ol.geom.Point(map.getView().getCenter()));
  
  
  map.getView().setCenter(geolocation.getPosition());
  marker.setGeometry(new ol.geom.Point(map.getView().getCenter()));
  
  
  
  };
  xhr.send();
  }
  
  
  function current_location() {
  var geolocation = new ol.Geolocation({
  projection: 'EPSG:3857'
  });
  geolocation.setTracking(true); // here the browser may ask for confirmation // das passt noch nicht so ganz
  geolocation.on('change:position', function() {
  geolocation.setTracking(false);
  map.getView().setCenter(geolocation.getPosition());
  marker.setGeometry(new ol.geom.Point(map.getView().getCenter()));
  });
  }
  
  var form = document.getElementById("search");
  
  </script>
    <script type="text/javascript" src="censusmap_wien.js"></script>
  </body>
</html>
